# LOCAL-LLM-Stack Components Documentation
# This file documents all system components in a machine-readable format

components:
  - type: "container"
    name: "ollama"
    purpose: "Provides local LLM inference capabilities"
    image: "ollama/ollama"
    version_var: "OLLAMA_VERSION"
    default_version: "0.1.27"
    ports:
      - internal: 11434
        external_var: "HOST_PORT_OLLAMA"
        default_external: 11434
        protocol: "tcp"
        purpose: "API"
    volumes:
      - host_path: "../data/ollama"
        container_path: "/root/.ollama"
        purpose: "model_storage"
      - host_path: "../data/models"
        container_path: "/models"
        purpose: "additional_models"
    environment_variables:
      - name: "OLLAMA_HOST"
        value: "0.0.0.0"
        purpose: "Listen on all interfaces"
      - name: "OLLAMA_MODELS_PATH"
        value: "/root/.ollama/models"
        purpose: "Model storage location"
    resource_limits:
      cpu_var: "OLLAMA_CPU_LIMIT"
      cpu_default: 0.75
      memory_var: "OLLAMA_MEMORY_LIMIT"
      memory_default: "16G"
    health_check:
      command: "bash -c \"(echo > /dev/tcp/localhost/11434) 2>/dev/null || exit 1\""
      interval: "30s"
      timeout: "10s"
      retries: 3
      start_period: "40s"
  
  - type: "container"
    name: "mongodb"
    purpose: "Provides database storage for LibreChat"
    image: "mongo"
    version_var: "MONGODB_VERSION"
    default_version: "6.0.6"
    volumes:
      - host_path: "../data/mongodb"
        container_path: "/data/db"
        purpose: "database_storage"
    resource_limits:
      memory_var: "MONGODB_MEMORY_LIMIT"
      memory_default: "2G"
    health_check:
      command: "mongosh --eval \"db.adminCommand('ping')\""
      interval: "30s"
      timeout: "10s"
      retries: 3
      start_period: "40s"
  
  - type: "container"
    name: "meilisearch"
    purpose: "Provides search capabilities for LibreChat"
    image: "getmeili/meilisearch"
    version_var: "MEILISEARCH_VERSION"
    default_version: "latest"
    volumes:
      - host_path: "../data/meilisearch"
        container_path: "/meili_data"
        purpose: "search_index_storage"
    environment_variables:
      - name: "MEILI_NO_ANALYTICS"
        value: "true"
        purpose: "Disable analytics"
      - name: "MEILI_ENV"
        value: "production"
        purpose: "Set environment to production"
      - name: "MEILI_MASTER_KEY"
        value: "masterKey123456789"
        purpose: "Set master key for authentication"
    resource_limits:
      memory_var: "MEILISEARCH_MEMORY_LIMIT"
      memory_default: "1G"
    health_check:
      command: "wget -q --spider http://127.0.0.1:7700/health || exit 1"
      interval: "30s"
      timeout: "10s"
      retries: 3
      start_period: "40s"
  
  - type: "container"
    name: "librechat"
    purpose: "Provides web interface for interacting with LLMs"
    image: "librechat/librechat"
    version_var: "LIBRECHAT_VERSION"
    default_version: "latest"
    ports:
      - internal: 3080
        external_var: "HOST_PORT_LIBRECHAT"
        default_external: 3080
        protocol: "tcp"
        purpose: "Web UI"
    volumes:
      - host_path: "../data/librechat"
        container_path: "/app/data"
        purpose: "data_storage"
      - host_path: "../config/librechat/librechat.yaml"
        container_path: "/app/librechat.yaml"
        purpose: "configuration"
      - host_path: "../data/librechat/.env"
        container_path: "/app/.env"
        purpose: "environment_variables"
    environment_variables:
      - name: "MONGO_URI"
        value: "mongodb://mongodb:27017/librechat"
        purpose: "MongoDB connection string"
      - name: "MEILI_HOST"
        value: "http://meilisearch:7700"
        purpose: "Meilisearch connection"
      - name: "OLLAMA_HOST"
        value: "http://ollama:11434"
        purpose: "Ollama API host"
      - name: "OLLAMA_API_BASE_URL"
        value: "http://ollama:11434/api"
        purpose: "Ollama API base URL"
      - name: "OLLAMA_BASE_URL"
        value: "http://ollama:11434"
        purpose: "Ollama base URL"
      - name: "OLLAMA_API_KEY"
        value: "${OLLAMA_API_KEY:-dummy-api-key}"
        purpose: "Ollama API key"
      - name: "OLLAMA_PROXY"
        value: "http://ollama:11434"
        purpose: "Ollama proxy URL"
      - name: "ENDPOINTS"
        value: "ollama"
        purpose: "Enabled endpoints"
      - name: "OLLAMA_MODELS"
        value: "${DEFAULT_MODELS:-tinyllama}"
        purpose: "Default models"
      - name: "PORT"
        value: "3080"
        purpose: "Internal port"
      - name: "HOST"
        value: "0.0.0.0"
        purpose: "Listen on all interfaces"
      - name: "ENABLE_MEILISEARCH"
        value: "true"
        purpose: "Enable Meilisearch integration"
      - name: "ENABLE_AUTH"
        value: "${ENABLE_AUTH:-true}"
        purpose: "Enable authentication"
      - name: "ALLOW_SOCIAL_LOGIN"
        value: "${ALLOW_SOCIAL_LOGIN:-false}"
        purpose: "Allow social login"
      - name: "ALLOW_REGISTRATION"
        value: "${ALLOW_REGISTRATION:-true}"
        purpose: "Allow user registration"
      - name: "ADMIN_EMAIL"
        value: "${ADMIN_EMAIL:-admin@local.host}"
        purpose: "Admin email"
      - name: "ADMIN_PASSWORD"
        value: "${ADMIN_PASSWORD:-}"
        purpose: "Admin password"
      - name: "JWT_SECRET"
        value: "${JWT_SECRET:-}"
        purpose: "JWT secret for authentication"
      - name: "JWT_REFRESH_SECRET"
        value: "${JWT_REFRESH_SECRET:-}"
        purpose: "JWT refresh secret"
      - name: "SESSION_SECRET"
        value: "${SESSION_SECRET:-}"
        purpose: "Session secret"
      - name: "CRYPT_SECRET"
        value: "${CRYPT_SECRET:-}"
        purpose: "Encryption secret"
      - name: "CREDS_KEY"
        value: "${CREDS_KEY:-}"
        purpose: "Credentials key"
      - name: "CREDS_IV"
        value: "${CREDS_IV:-}"
        purpose: "Credentials IV"
    resource_limits:
      cpu_var: "LIBRECHAT_CPU_LIMIT"
      cpu_default: 0.50
      memory_var: "LIBRECHAT_MEMORY_LIMIT"
      memory_default: "4G"
    health_check:
      command: "wget -q --spider http://localhost:3080/health || exit 1"
      interval: "30s"
      timeout: "10s"
      retries: 3
      start_period: "40s"
  
  - type: "script"
    name: "llm"
    purpose: "Main CLI script for managing the LOCAL-LLM-Stack"
    environment_variables:
      - name: "SCRIPT_DIR"
        value: "$(cd \"$(dirname \"${BASH_SOURCE[0]}\")\" && pwd)"
        purpose: "Script directory path"
    dependencies:
      - name: "lib/core/logging.sh"
        purpose: "Logging functions"
      - name: "lib/core/error.sh"
        purpose: "Error handling functions"
      - name: "lib/core/config.sh"
        purpose: "Configuration management functions"
      - name: "lib/common.sh"
        purpose: "Common utility functions"
  
  - type: "library"
    name: "config"
    purpose: "Configuration management for LOCAL-LLM-Stack"
    file: "lib/core/config.sh"
    dependencies:
      - name: "lib/core/logging.sh"
        purpose: "Logging functions"
      - name: "lib/core/error.sh"
        purpose: "Error handling functions"
      - name: "lib/core/system.sh"
        purpose: "System operation functions"
      - name: "lib/core/validation.sh"
        purpose: "Validation functions"
    constants:
      - name: "DEFAULT_CONFIG_DIR"
        value: "config"
        purpose: "Default configuration directory"
      - name: "DEFAULT_ENV_FILE"
        value: "$DEFAULT_CONFIG_DIR/.env"
        purpose: "Default environment file"
      - name: "DEFAULT_CORE_PROJECT"
        value: "local-llm-stack"
        purpose: "Default core project name"
      - name: "DEFAULT_DEBUG_PROJECT"
        value: "$DEFAULT_CORE_PROJECT-debug"
        purpose: "Default debug project name"
      - name: "DEFAULT_CORE_COMPOSE"
        value: "-f core/docker-compose.yml"
        purpose: "Default core compose file"
      - name: "DEFAULT_DEBUG_COMPOSE"
        value: "$DEFAULT_CORE_COMPOSE -f core/docker-compose.debug.yml"
        purpose: "Default debug compose file"